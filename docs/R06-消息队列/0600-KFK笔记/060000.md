# 基础知识

## 基础概念

| 组件 | 组件名 | 描述 |
|------|--------|------|
| producer | 消息生产者 | 向Kafka broker发送消息的客户端 |
| consumer | 消息消费者 | 从Kafka broker获取消息的客户端 |
| consumer group | 消费者组(CG) | 组内每个消费者负责消费不同分区的数据，提高消费能力。一个分区只能由组内一个消费者消费，消费者组之间互不影响。所有的消费者都属于某个消费者组，即消费者组是逻辑上的一个订阅者。 |
| broker | Kafka节点 | 一台Kafka机器就是一个broker。一个集群由多个broker组成。一个broker可以容纳多个topic |
| topic | 主题 | 可以理解为一个队列，topic将消息分类，生产者和消费者面向的是同一个Topic |
| partition | 分区 | 为了实现扩展性，提高并发能力，一个topic可以分为多个partition，同一个topic在不同的分区的数据是不重复的，每个partition是一个有序的队列 |
| replication | 副本 | 每个分区都有多个副本，副本的作用是做容灾备份。当主副本(Leader)故障时会选择一个副本(Follower)上位成为Leader |
| message | 消息 | 每一条发送的消息主体 |
| leader | 主副本 | 每个分区多个副本的"主"副本，生产者发送数据和消费者消费数据的对象 |
| follower | 从副本 | 每个分区多个副本的"从"副本，实时从Leader同步数据 |
| offset | 偏移量 | 消费者消费的位置信息，同一主题不同分区的offset相互独立 |

**备注**

1. 一个分区只属于一个主题，一个主题可以有多个分区
2. 同一主题的不同分区内容不一样，每个分区有自己独立的offset
3. 同一主题不同的分区能够放置到不同节点的broker
4. 分区规则设置得当可以使得同一主题的消息均匀分布在不同的分区

## 相关操作

### 1. 启动Kafka

#### 启动ZooKeeper
```bash
# 前台启动
bin/zookeeper-server-start.sh config/zookeeper.properties

# 后台启动
nohup bin/zookeeper-server-start.sh config/zookeeper.properties > /var/log/kafka/zookeeper.log 2>&1 &
```

#### 启动KFK服务器
在 ZooKeeper 启动后，使用以下命令启动 Kafka 服务器：

```bash
# 前台启动
bin/kafka-server-start.sh config/server.properties
# 后台启动
nohup bin/kafka-server-start.sh config/server.properties > /var/log/kafka/kafka.log 2>&1 &
```

### 2.创建主题
```bash
bin/kafka-topics.sh --create --topic "topic-one" --zookeeper localhost:2181 --partitions 1 --replication-factor 1
```
#### 验证主题创建
```bash
bin/kafka-topics.sh --list --zookeeper localhost:2181
```
### 3.发送消息
```bash
bin/kafka-console-producer.sh --topic "topic-one" --broker-list localhost:9092
```
### 4.消息消费
```bash
bin/kafka-console-consumer.sh --topic "topic-one" --from-beginning --bootstrap-server localhost:9092
```
