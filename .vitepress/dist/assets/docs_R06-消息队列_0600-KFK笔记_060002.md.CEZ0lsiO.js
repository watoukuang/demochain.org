import{_ as e,C as a,c as i,o as n,j as s,G as o,ai as r,a as l}from"./framework-Cfw8I1ux.js";const b=JSON.parse('{"title":"参数详解","description":"","frontmatter":{},"headers":[],"relativePath":"docs/R06-消息队列/0600-KFK笔记/060002.md","filePath":"docs/R06-消息队列/0600-KFK笔记/060002.md"}'),h={name:"docs/R06-消息队列/0600-KFK笔记/060002.md"};function c(p,t,k,g,y,u){const d=a("ArticleMetadata");return n(),i("div",null,[t[0]||(t[0]=s("h1",{id:"参数详解",tabindex:"-1"},[l("参数详解 "),s("a",{class:"header-anchor",href:"#参数详解","aria-label":'Permalink to "参数详解"'},"​")],-1)),o(d),t[1]||(t[1]=r(`<p>以下是Kafka常见参数配置的详细解析，按照组件分类并标注关键场景的使用建议：</p><hr><h3 id="一、生产者-producer-配置" tabindex="-1"><strong>一、生产者（Producer）配置</strong> <a class="header-anchor" href="#一、生产者-producer-配置" aria-label="Permalink to &quot;**一、生产者（Producer）配置**&quot;">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>默认值</th><th>说明</th><th>推荐值（金融场景）</th><th>注意事项</th></tr></thead><tbody><tr><td><code>bootstrap.servers</code></td><td>-</td><td>Kafka集群地址列表</td><td>至少配置3个broker地址</td><td>建议配置全部broker提高容错</td></tr><tr><td><code>acks</code></td><td>1</td><td>消息确认机制<br>0=不等待<br>1=leader确认<br>all=所有ISR确认</td><td><code>all</code></td><td>强一致性场景必须设为<code>all</code></td></tr><tr><td><code>retries</code></td><td>2147483647</td><td>发送失败重试次数</td><td><code>Integer.MAX_VALUE</code></td><td>需配合<code>max.in.flight...=1</code>使用</td></tr><tr><td><code>max.in.flight.requests.per.connection</code></td><td>5</td><td>单个连接未确认请求数</td><td><code>1</code></td><td>保证顺序性时必须设为1</td></tr><tr><td><code>enable.idempotence</code></td><td>false</td><td>是否启用幂等</td><td><code>true</code></td><td>需<code>retries&gt;0</code>且<code>acks=all</code></td></tr><tr><td><code>compression.type</code></td><td>none</td><td>压缩算法<br>(none/gzip/snappy/lz4/zstd)</td><td><code>lz4</code></td><td>平衡CPU和带宽消耗</td></tr><tr><td><code>linger.ms</code></td><td>0</td><td>消息发送延迟时间</td><td><code>5</code></td><td>提高吞吐但增加延迟</td></tr><tr><td><code>batch.size</code></td><td>16384</td><td>批次大小(字节)</td><td><code>65536</code></td><td>根据消息大小调整</td></tr><tr><td><code>request.timeout.ms</code></td><td>30000</td><td>请求超时时间</td><td><code>60000</code></td><td>网络不稳定时调高</td></tr><tr><td><code>max.block.ms</code></td><td>60000</td><td>缓冲区满时阻塞时间</td><td><code>30000</code></td><td>避免长时间阻塞</td></tr></tbody></table><hr><h3 id="二、消费者-consumer-配置" tabindex="-1"><strong>二、消费者（Consumer）配置</strong> <a class="header-anchor" href="#二、消费者-consumer-配置" aria-label="Permalink to &quot;**二、消费者（Consumer）配置**&quot;">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>默认值</th><th>说明</th><th>推荐值</th><th>注意事项</th></tr></thead><tbody><tr><td><code>group.id</code></td><td>-</td><td>消费者组ID</td><td>按业务命名</td><td>必须唯一</td></tr><tr><td><code>auto.offset.reset</code></td><td>latest</td><td>无偏移量时策略<br>(earliest/latest/none)</td><td><code>earliest</code></td><td>避免消息丢失</td></tr><tr><td><code>enable.auto.commit</code></td><td>true</td><td>自动提交偏移量</td><td><code>false</code></td><td>严格场景手动提交</td></tr><tr><td><code>auto.commit.interval.ms</code></td><td>5000</td><td>自动提交间隔</td><td>-</td><td>手动提交时无效</td></tr><tr><td><code>isolation.level</code></td><td>read_uncommitted</td><td>事务隔离级别</td><td><code>read_committed</code></td><td>事务消息必设</td></tr><tr><td><code>max.poll.records</code></td><td>500</td><td>单次poll最大消息数</td><td><code>100</code></td><td>控制处理批次</td></tr><tr><td><code>max.poll.interval.ms</code></td><td>300000</td><td>poll间隔超时时间</td><td><code>600000</code></td><td>长时间处理需调大</td></tr><tr><td><code>session.timeout.ms</code></td><td>10000</td><td>会话超时时间</td><td><code>30000</code></td><td>心跳检测间隔</td></tr><tr><td><code>heartbeat.interval.ms</code></td><td>3000</td><td>心跳发送间隔</td><td><code>5000</code></td><td>需小于<code>session.timeout.ms</code></td></tr></tbody></table><hr><h3 id="三、broker服务端配置" tabindex="-1"><strong>三、Broker服务端配置</strong> <a class="header-anchor" href="#三、broker服务端配置" aria-label="Permalink to &quot;**三、Broker服务端配置**&quot;">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>默认值</th><th>说明</th><th>推荐值</th><th>注意事项</th></tr></thead><tbody><tr><td><code>log.dirs</code></td><td>/tmp/kafka-logs</td><td>数据存储目录</td><td>多磁盘路径逗号分隔</td><td>提高IO吞吐</td></tr><tr><td><code>num.partitions</code></td><td>1</td><td>默认分区数</td><td>根据业务需求</td><td>创建topic时可覆盖</td></tr><tr><td><code>default.replication.factor</code></td><td>1</td><td>默认副本数</td><td><code>3</code></td><td>生产环境≥2</td></tr><tr><td><code>min.insync.replicas</code></td><td>1</td><td>最小同步副本数</td><td><code>2</code></td><td>需<code>replication.factor≥3</code></td></tr><tr><td><code>unclean.leader.election.enable</code></td><td>true</td><td>允许非ISR成为leader</td><td><code>false</code></td><td>避免数据丢失</td></tr><tr><td><code>log.retention.hours</code></td><td>168</td><td>数据保留时间</td><td><code>24</code></td><td>根据存储需求调整</td></tr><tr><td><code>log.retention.bytes</code></td><td>-1</td><td>分区最大容量</td><td><code>10737418240</code>(10GB)</td><td>需监控磁盘</td></tr><tr><td><code>message.max.bytes</code></td><td>1000012</td><td>单条消息最大值</td><td><code>10485760</code>(10MB)</td><td>需同步调整消费者配置</td></tr></tbody></table><hr><h3 id="四、topic级别配置" tabindex="-1"><strong>四、Topic级别配置</strong> <a class="header-anchor" href="#四、topic级别配置" aria-label="Permalink to &quot;**四、Topic级别配置**&quot;">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>默认值</th><th>说明</th><th>推荐值</th></tr></thead><tbody><tr><td><code>cleanup.policy</code></td><td>delete</td><td>清理策略<br>(delete/compact)</td><td><code>delete</code></td></tr><tr><td><code>retention.ms</code></td><td>604800000</td><td>保留时间(ms)</td><td><code>86400000</code>(1天)</td></tr><tr><td><code>segment.bytes</code></td><td>1073741824</td><td>分段文件大小</td><td><code>536870912</code>(512MB)</td></tr><tr><td><code>max.message.bytes</code></td><td>1000012</td><td>单消息最大字节</td><td>与broker配置一致</td></tr></tbody></table><hr><h3 id="五、关键场景配置模板" tabindex="-1"><strong>五、关键场景配置模板</strong> <a class="header-anchor" href="#五、关键场景配置模板" aria-label="Permalink to &quot;**五、关键场景配置模板**&quot;">​</a></h3><h4 id="_1-金融交易场景-强顺序性" tabindex="-1">1. <strong>金融交易场景（强顺序性）</strong> <a class="header-anchor" href="#_1-金融交易场景-强顺序性" aria-label="Permalink to &quot;1. **金融交易场景（强顺序性）**&quot;">​</a></h4><div class="language-properties vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Producer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">acks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=all</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enable.idempotence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">max.in.flight.requests.per.connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">compression.type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=lz4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Consumer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">isolation.level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=read_committed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enable.auto.commit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto.offset.reset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=earliest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Broker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">min.insync.replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">unclean.leader.election.enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=false</span></span></code></pre></div><h4 id="_2-日志收集场景-高吞吐" tabindex="-1">2. <strong>日志收集场景（高吞吐）</strong> <a class="header-anchor" href="#_2-日志收集场景-高吞吐" aria-label="Permalink to &quot;2. **日志收集场景（高吞吐）**&quot;">​</a></h4><div class="language-properties vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Producer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">acks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">compression.type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=snappy</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">linger.ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=20</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">batch.size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=32768</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Broker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log.retention.hours</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=72</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">num.io.threads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=8</span></span></code></pre></div><hr><h3 id="六、监控与调优建议" tabindex="-1"><strong>六、监控与调优建议</strong> <a class="header-anchor" href="#六、监控与调优建议" aria-label="Permalink to &quot;**六、监控与调优建议**&quot;">​</a></h3><ol><li><p><strong>关键指标监控</strong>：</p><ul><li>生产者：<code>record-error-rate</code>, <code>request-latency-avg</code></li><li>消费者：<code>records-lag-max</code>, <code>poll-rate</code></li><li>Broker：<code>UnderReplicatedPartitions</code>, <code>ActiveControllerCount</code></li></ul></li><li><p><strong>性能调优工具</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生产者性能测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kafka-producer-perf-test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --topic</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --num-records</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --record-size</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --throughput</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --producer-props</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bootstrap.servers=localhost:9092</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 消费者偏移量检查</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kafka-consumer-groups</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --bootstrap-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost:9092</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --describe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --group</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-group</span></span></code></pre></div></li><li><p><strong>参数关联性</strong>：</p><ul><li><code>linger.ms</code> ↑ + <code>batch.size</code> ↑ → 吞吐量↑ 但延迟↑</li><li><code>num.io.threads</code> ↑ → 网络IO处理能力↑</li><li><code>log.flush.interval.messages</code> ↓ → 数据安全性↑ 但性能↓</li></ul></li></ol><hr><p>通过合理配置这些参数，可以在 <strong>消息顺序性</strong>、<strong>可靠性</strong> 和 <strong>吞吐量</strong> 之间取得最佳平衡。建议在生产环境进行压测后最终确定参数值。</p>`,24))])}const F=e(h,[["render",c]]);export{b as __pageData,F as default};
